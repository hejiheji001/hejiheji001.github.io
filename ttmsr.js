var retryCap=50,retryBuy=50,MSTarget=-1,captcha="",notRunning=!0,notSubmit=!0,timeLeft=1e3,version="V15",bannedKeys=["P2gv+Ol0uGjoqXS6HWGovdiQ6ukyDbpv","KUyIf2VcxGzdGtvFWK7vBibfHPr68Zjt","+JNBj78KXZyrvgVLP5AC6Q/SMem7j3fd"],getEnc=function(){var e=$("h3").text(),t=e.split("V")[0]+version;$("h3").text(t),-1===bannedKeys.indexOf(uk)?$.getScript("https://hejiheji001.github.io/onlyone-1.0.0.min.js?rand="+Math.random(),getCountDown):alert("试用已到期～")},getCountDown=function(e){var t=e||"",a=$("#autobuy");a.text("正在获取倒计时"+t);var r={1:["A20170206786","G201702078122","0009123"],3:["A20170505897","G201705057258","0007134"],4:["A20170505897","G201705057259","0007135"],5:["A20170505897","G201705057260","0007136"],6:["A20170505897","G201705057261","0007137"],0:["A20170505897","G201705057262","0007138"]},n=(new Date).getDay();if(2==n)return void alert("今日无活动～");var o=r[n][0],c=r[n][1],t=r[n][2],u="https://prefacty.creditcard.cmbc.com.cn/mmc-main-webapp/main/QueryGift.json?actyId="+o+"&giftId="+c+"&isQualify=true&maxInterval=172800&userKey="+encodeURIComponent(uk);checkCaptcha(handleCountdown,u)},getOrder=function(){var e={1:["A20170206786","G201702078122","0009123"],3:["A20170505897","G201705057258","0007134"],4:["A20170505897","G201705057259","0007135"],5:["A20170505897","G201705057260","0007136"],6:["A20170505897","G201705057261","0007137"],0:["A20170505897","G201705057262","0007138"]},t=(new Date).getDay();if(2==t)return void alert("今日无活动～");var a=e[t][0],r=e[t][1],n=e[t][2];return localStorage.userKey=uk,"https://prefacty.creditcard.cmbc.com.cn/mmc-main-webapp/main/Order.json?tmp="+getTmp()+"&channelType=activityday&giftNum=1&groupId=&isCaptcha=true&actyId="+a+"&giftId="+r+"&merchantId="+n+"&userKey="+encodeURIComponent(uk)+"&jcaptchaText="+captcha},pausecomp=function(e){var t=new Date,a=null;do a=new Date;while(e>a-t)},checkCaptcha=function(e,t){if(retryCap--,console.log("checkCaptcha"),retryCap>0){var a=getOrder();t&&(a=t),$.ajax({url:"https://query.yahooapis.com/v1/public/yql",dataType:"json",timeout:8e3,data:{format:"json",q:$("#autobuy").data("ql")+a+$("#autobuy").data("qr")},success:e,error:function(a,r){retryCaptcha(a,r,e,t)}})}else $("#autobuy").text("无法检测验证码 碰碰运气"),t?e():doForcePay()},retryCaptcha=function(e,t,a,r){var n=$("#autobuy").text().split(" ")[0];$("#autobuy").text(n+" 第"+(50-retryCap)+"次尝试"),checkCaptcha(a,r)},placeOrder=function(e,t){var a=new Date,r=a.toLocaleString("zh-cn",{hour12:!1}).split(" ")[0],n=a.getTime(),o=new Date(r+" "+(e-1)+":59:58").getTime();MSTarget>0&&(o=MSTarget);var c=getOrder();console.log("placeOrder in "+(o-n)),$(t).text("任务已提交 "+(o-n)/1e3+"秒后自动抢购"),notRunning=!1;setTimeout(function(){$(t).text("抢购中"),console.log("Placing Order");for(var e=0;35>e;e++)e%5==0?(retryCap++,checkCaptcha(handleCaptcha)):$.ajax({url:c,dataType:"jsonp"}),pausecomp(30)},(o-n)/1)},getThisOrder=function(){var e=(new Date).getHours();return 10>e||10===e?10:15},buyIt=function(e){console.log("buyIt"),retryBuy--;var t=$("#autobuy");retryBuy>0&&timeLeft>10?(t.attr("onclick","buyIt()"),e?t.text(e+" 重新获取验证码中"):t.text("获取验证码中"),getCaptcha(function(e){e.Result&&5===e.Result.length?(retryCap++,captcha=e.Result.toUpperCase(),t.text("检测验证码中，验证码为 "+captcha),checkCaptcha(handleCaptcha)):buyIt(e.Error)})):(t.text("无法验证码 碰碰运气"),doForcePay())},doForcePay=function(){if(captcha){console.log("doForcePay");var e=getThisOrder();placeOrder(e,"#autobuy")}else $("#autobuy").text("请立即截图 并及时联系开发者")},getCaptcha=function(e){$.ajax({type:"POST",url:"http://api.ruokuai.com/create.json",timeout:8e3,data:{username:"hejiheji001",password:"CE649C68CCB1763AC369C4A05EEC3914",typeid:"3050",softid:"84562",softkey:"ea41751488db4a43a55cb436cd35afac",imageurl:"https://prefacty.creditcard.cmbc.com.cn/mmc-main-webapp/jcaptcha.img?userKey="+encodeURIComponent(uk)},success:e,error:retryBuyIt,dataType:"json"})},retryBuyIt=function(){buyIt("验证码获取失败")},formaTime=function(e){return 10>e?"0"+e:""+e},getTimeFormat=function(e){var t=Math.floor(e/3600),a=Math.floor(e%3600/60),r=e%60;return e>=0?"距离抢兑开始还有 "+formaTime(t)+":"+formaTime(a)+":"+formaTime(r):""},handleCountdown=function(e){retryCap++,window["int"]&&window.clearInterval(int);var t=$("#autobuy");if(t.attr("onclick","getCountDown();"),e.query.results){var a=e.query.results,r=window.debugTime||a.reply.countDownTimes,n=window.debugCount||a.reply.isCountDown;if(n){var o=Math.floor(55-5*(Math.random()+1));t.text(getTimeFormat(r)+" 验证码将于"+(r-o)+"秒后获取"),window["int"]=self.setInterval(function(){r--,timeLeft=r,o>=r&&notSubmit&&(notSubmit=!1,MSTarget=(new Date).getTime()+1e3*r,buyIt()),r>o&&t.text(getTimeFormat(r)+" 验证码将于"+(r-o)+"秒后获取"),r>0&&console.log(getTimeFormat(r)+" 验证码将于"+(r-o)+"秒后获取"),0==r&&(window.clearInterval(int),notRunning&&doForcePay())},1e3)}else t.text("暂无民生倒计时"),captcha&&doForcePay()}else getCountDown(" 您的网速可能较慢 第"+(50-retryCap)+"次尝试")},handleCaptcha=function(e){var t=$("#autobuy");if(console.log("handleCaptcha"),e.query.results){var a=e.query.results.reply.orderMessage;if(a)if(t.text(a),-1<a.indexOf("尚未开始")){var r=getThisOrder();placeOrder(r,"#autobuy")}else if(-1<a.indexOf("支付"))alert("成功了");else if(15===getThisOrder()&&"已经抢光啦"===a&&notRunning){var r=getThisOrder();placeOrder(r,"#autobuy")}else-1<a.indexOf("key")?buyIt(a):-1<a.indexOf("图片")?buyIt(a):-1<a.indexOf("userKey非正常加密")?alert("请立即截图 userKey非正常加密"):t.text("请不要离开本页面 03分之后再查看待支付");else doForcePay()}else checkCaptcha(handleCaptcha)};
